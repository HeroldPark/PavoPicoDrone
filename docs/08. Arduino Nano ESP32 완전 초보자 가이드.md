# 🚀 Arduino Nano ESP32 완전 초보자 가이드

## 📋 목표: 드론 개발을 위한 ESP32 환경 구축 및 기본 테스트

---

## 1️⃣ 개발 환경 구축 (30분)

### **1.1 Arduino IDE 2.0 설치**

#### **Windows 사용자**
1. **Arduino IDE 다운로드**
   - 공식 사이트: https://www.arduino.cc/en/software
   - "Windows Win 10 and newer, 64 bits" 선택
   - `.exe` 파일 다운로드 후 설치

2. **설치 확인**
   - 바탕화면에 Arduino IDE 아이콘 생성 확인
   - 더블클릭으로 실행

#### **Mac 사용자**
1. **Arduino IDE 다운로드**
   - "macOS 10.14: "Mojave" or newer, 64 bits" 선택
   - `.dmg` 파일 다운로드
   - 파일 실행 후 Applications 폴더로 드래그

### **1.2 ESP32 보드 패키지 설치**

#### **단계별 설치 과정**
```
1. Arduino IDE 실행
2. 메뉴: File → Preferences (환경설정)
3. "Additional boards manager URLs"에 다음 URL 추가:
   https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json

4. OK 클릭

5. 메뉴: Tools → Board → Boards Manager
6. 검색창에 "esp32" 입력
7. "esp32 by Espressif Systems" 찾기
8. 버전 2.0.14 이상 선택하여 Install
9. 설치 완료까지 대기 (약 5-10분)
```

#### **설치 확인 방법**
```
Tools → Board → esp32 → Arduino Nano ESP32
메뉴에서 "Arduino Nano ESP32" 보드가 보이면 성공!
```

### **1.3 필수 라이브러리 설치**

#### **라이브러리 매니저를 통한 설치**
```
메뉴: Tools → Manage Libraries (라이브러리 관리자)

각각 검색하여 설치:
1. "MPU9250" 검색 → "MPU9250 by hideakitai" 설치
2. "ESP32Servo" 검색 → "ESP32Servo by Kevin Harrington" 설치  
3. "ArduinoJson" 검색 → "ArduinoJson by Benoit Blanchon" 설치
4. "AsyncTCP" 검색 → "AsyncTCP-esphome by dvarrel" 설치
5. "ESPAsyncWebServer" 검색 → "ESP Async WebServer" 설치
6. "PID" 검색 → "PID by Brett Beauregard" 설치
```

### **1.4 드라이버 설치 (중요!)**

#### **USB 드라이버 확인**
Arduino Nano ESP32는 USB-C 포트를 사용합니다.

**Windows:**
- 대부분 자동 인식되지만, 인식 안 될 경우:
- CP210x USB to UART Bridge 드라이버 설치
- 다운로드: https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers

**Mac:**
- 보통 자동 인식됨
- 문제 시 동일한 CP210x 드라이버 설치

---

## 2️⃣ 하드웨어 연결 및 기본 테스트

### **2.1 Arduino Nano ESP32 핀아웃 확인**

```
Arduino Nano ESP32 주요 핀:
• VIN: 6-21V 외부 전원 입력
• 5V: 5V 출력 (USB 연결시만)
• 3.3V: 3.3V 출력 
• GND: 접지
• RST: 리셋 버튼
• D0~D13: 디지털 핀
• A0~A7: 아날로그 핀
• SDA/SCL: I2C 통신 (D4/D5)
• RX/TX: 시리얼 통신 (D0/D1)
```

### **2.2 첫 번째 테스트: LED 점멸**

#### **하드웨어 연결**
```
준비물:
• Arduino Nano ESP32
• USB-C 케이블
• 브레드보드
• LED 1개
• 220Ω 저항 1개
• 점퍼 와이어

연결 방법:
1. Arduino Nano ESP32를 브레드보드에 삽입
2. D2 핀 → 220Ω 저항 → LED 긴 다리 (애노드)
3. LED 짧은 다리 (캐소드) → GND
```

#### **코드 작성 및 업로드**
```cpp
// 파일명: 01_LED_Blink_Test.ino

/*
 * Arduino Nano ESP32 LED 점멸 테스트
 * 목적: 기본 하드웨어 동작 확인
 */

const int ledPin = 2;  // LED 연결 핀

void setup() {
  // 시리얼 통신 시작 (디버깅용)
  Serial.begin(115200);
  
  // LED 핀을 출력으로 설정
  pinMode(ledPin, OUTPUT);
  
  Serial.println("Arduino Nano ESP32 LED 테스트 시작!");
  Serial.println("LED가 1초마다 깜빡여야 합니다.");
}

void loop() {
  // LED 켜기
  digitalWrite(ledPin, HIGH);
  Serial.println("LED ON");
  delay(1000);  // 1초 대기
  
  // LED 끄기  
  digitalWrite(ledPin, LOW);
  Serial.println("LED OFF");
  delay(1000);  // 1초 대기
}
```

#### **업로드 과정**
```
1. Arduino IDE에서 위 코드 입력
2. Tools → Board → esp32 → Arduino Nano ESP32 선택
3. Tools → Port → 적절한 COM 포트 선택 (Windows: COM3, COM4 등)
4. 왼쪽 상단 업로드 버튼 (→) 클릭
5. "Done uploading" 메시지 확인
```

#### **예상 결과**
- LED가 1초마다 깜빡임
- 시리얼 모니터에 "LED ON/OFF" 메시지 출력

---

### **2.3 두 번째 테스트: 시리얼 통신 확인**

#### **코드**
```cpp
// 파일명: 02_Serial_Test.ino

/*
 * Arduino Nano ESP32 시리얼 통신 테스트
 * 목적: USB 시리얼 통신 정상 작동 확인
 */

void setup() {
  // 시리얼 통신 시작
  Serial.begin(115200);
  
  // ESP32 완전 부팅 대기
  delay(1000);
  
  Serial.println("====================================");
  Serial.println("Arduino Nano ESP32 시리얼 테스트");
  Serial.println("====================================");
  Serial.print("CPU 주파수: ");
  Serial.print(getCpuFrequencyMhz());
  Serial.println(" MHz");
  
  Serial.print("Flash 크기: ");
  Serial.print(ESP.getFlashChipSize() / 1024 / 1024);
  Serial.println(" MB");
  
  Serial.print("여유 메모리: ");
  Serial.print(ESP.getFreeHeap());
  Serial.println(" bytes");
  
  Serial.println("\n카운터 시작...");
}

void loop() {
  static int counter = 0;
  
  Serial.print("카운터: ");
  Serial.println(counter++);
  
  // 메모리 사용량 모니터링
  if (counter % 10 == 0) {
    Serial.print("현재 여유 메모리: ");
    Serial.print(ESP.getFreeHeap());
    Serial.println(" bytes");
  }
  
  delay(1000);
}
```

#### **시리얼 모니터 확인**
```
1. 코드 업로드 후
2. Tools → Serial Monitor 클릭
3. 우하단 보드레이트를 115200으로 설정
4. 시스템 정보와 카운터가 출력되는지 확인
```

---

### **2.4 세 번째 테스트: WiFi 연결**

#### **코드**
```cpp
// 파일명: 03_WiFi_Test.ino

/*
 * Arduino Nano ESP32 WiFi 연결 테스트
 * 목적: 무선 통신 기능 확인
 */

#include <WiFi.h>

// WiFi 설정 (본인의 WiFi 정보로 변경!)
const char* ssid = "YOUR_WIFI_NAME";        // WiFi 이름
const char* password = "YOUR_WIFI_PASSWORD"; // WiFi 비밀번호

void setup() {
  Serial.begin(115200);
  delay(1000);
  
  Serial.println("\n====================================");
  Serial.println("Arduino Nano ESP32 WiFi 테스트");
  Serial.println("====================================");
  
  // WiFi 연결 시작
  WiFi.begin(ssid, password);
  Serial.print("WiFi 연결 중");
  
  // 연결 대기 (최대 20초)
  int attempts = 0;
  while (WiFi.status() != WL_CONNECTED && attempts < 20) {
    delay(1000);
    Serial.print(".");
    attempts++;
  }
  
  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("\n✅ WiFi 연결 성공!");
    Serial.print("IP 주소: ");
    Serial.println(WiFi.localIP());
    Serial.print("신호 강도: ");
    Serial.print(WiFi.RSSI());
    Serial.println(" dBm");
    Serial.print("MAC 주소: ");
    Serial.println(WiFi.macAddress());
  } else {
    Serial.println("\n❌ WiFi 연결 실패!");
    Serial.println("WiFi 이름과 비밀번호를 확인하세요.");
  }
}

void loop() {
  // WiFi 연결 상태 모니터링
  if (WiFi.status() == WL_CONNECTED) {
    Serial.print("WiFi 연결됨 - IP: ");
    Serial.print(WiFi.localIP());
    Serial.print(", 신호강도: ");
    Serial.print(WiFi.RSSI());
    Serial.println(" dBm");
  } else {
    Serial.println("WiFi 연결 끊어짐");
    // 재연결 시도
    WiFi.reconnect();
  }
  
  delay(5000);  // 5초마다 체크
}
```

#### **주의사항**
```cpp
// 코드에서 다음 부분을 본인의 WiFi 정보로 변경!
const char* ssid = "우리집WiFi";           // ← 실제 WiFi 이름
const char* password = "wifi비밀번호123";    // ← 실제 비밀번호
```

---

### **2.5 네 번째 테스트: 전력 소비 측정**

#### **하드웨어 연결**
```
준비물:
• 멀티미터 (SunFounder 키트 포함)
• 점퍼 와이어
• 브레드보드

측정 방법:
1. USB 케이블 분리
2. VIN 핀에 5V 외부 전원 연결
3. 멀티미터를 전류 측정 모드 (mA)로 설정
4. 전원 +선과 VIN 핀 사이에 멀티미터 직렬 연결
```

#### **전력 측정 코드**
```cpp
// 파일명: 04_Power_Test.ino

/*
 * Arduino Nano ESP32 전력 소비 테스트
 * 목적: 다양한 모드에서 전력 소비량 확인
 */

#include <WiFi.h>

void setup() {
  Serial.begin(115200);
  delay(1000);
  
  Serial.println("====================================");
  Serial.println("전력 소비 테스트 시작");
  Serial.println("====================================");
  
  testNormalMode();
  testWiFiMode();
  testLightSleepMode();
  testDeepSleepMode();
}

void testNormalMode() {
  Serial.println("\n📊 일반 모드 테스트 (10초)");
  Serial.println("멀티미터로 전류를 측정하세요");
  
  for (int i = 0; i < 10; i++) {
    Serial.print("대기 중... ");
    Serial.println(i + 1);
    delay(1000);
  }
  Serial.println("✅ 일반 모드 측정 완료");
}

void testWiFiMode() {
  Serial.println("\n📊 WiFi 활성 모드 테스트 (10초)");
  
  WiFi.begin("TestAP", "password");  // 존재하지 않는 AP (스캔 활동 유지)
  
  for (int i = 0; i < 10; i++) {
    Serial.print("WiFi 스캔 중... ");
    Serial.println(i + 1);
    delay(1000);
  }
  
  WiFi.disconnect();
  Serial.println("✅ WiFi 모드 측정 완료");
}

void testLightSleepMode() {
  Serial.println("\n📊 Light Sleep 모드 테스트 (5초)");
  Serial.println("절전 모드 진입...");
  
  esp_sleep_enable_timer_wakeup(5 * 1000000);  // 5초 후 깨어남
  esp_light_sleep_start();
  
  Serial.println("✅ Light Sleep 모드 측정 완료");
}

void testDeepSleepMode() {
  Serial.println("\n📊 Deep Sleep 모드 테스트");
  Serial.println("10초 후 Deep Sleep 진입 (30초간)");
  Serial.println("30초 후 자동으로 재시작됩니다");
  
  delay(10000);
  
  esp_sleep_enable_timer_wakeup(30 * 1000000);  // 30초 후 재시작
  esp_deep_sleep_start();
}

void loop() {
  // setup()에서 모든 테스트 완료
}
```

#### **예상 전력 소비량**
```
📊 Arduino Nano ESP32 전력 소비:
• 일반 모드: 80-120mA @ 3.3V
• WiFi 활성: 120-200mA @ 3.3V  
• Light Sleep: 1-5mA @ 3.3V
• Deep Sleep: 10-100μA @ 3.3V

드론 적용시 고려사항:
• 비행 중: 100-150mA (센서 + WiFi)
• 대기 모드: Light Sleep 활용하여 5mA 이하
• 장기 보관: Deep Sleep으로 며칠간 보관 가능
```

---

## 3️⃣ 문제 해결 가이드

### **자주 발생하는 문제들**

#### **3.1 업로드 실패**
```
❌ 문제: "Failed to connect to ESP32"
✅ 해결:
1. USB-C 케이블 확인 (데이터 전송 지원 케이블인지)
2. 포트 재선택 (Tools → Port)
3. 업로드 중 RST 버튼 한 번 누르기
4. 드라이버 재설치
```

#### **3.2 시리얼 모니터에 이상한 문자**
```
❌ 문제: 한글이 깨지거나 의미 없는 기호
✅ 해결:
1. 보드레이트 확인 (115200으로 설정)
2. 시리얼 모니터 재시작
3. USB 케이블 재연결
```

#### **3.3 WiFi 연결 안됨**
```
❌ 문제: WiFi 연결 실패
✅ 해결:
1. WiFi 이름/비밀번호 재확인
2. 2.4GHz WiFi만 지원 (5GHz 안됨)
3. 공유기와 거리 확인
4. 방화벽 설정 확인
```

#### **3.4 전력 소비 과다**
```
❌ 문제: 예상보다 높은 전력 소비
✅ 해결:
1. WiFi 불필요시 WiFi.disconnect() 호출
2. 사용 안 하는 핀 적절한 모드로 설정
3. 클록 주파수 낮추기 (setCpuFrequencyMhz)
4. 불필요한 주변장치 비활성화
```

---

## 4️⃣ 다음 단계 준비

### **4.1 성공 확인 체크리스트**
```
□ LED 점멸 정상 작동
□ 시리얼 통신 정상
□ WiFi 연결 성공  
□ IP 주소 할당 확인
□ 전력 소비 측정 완료
□ 시스템 정보 출력 정상
```

### **4.2 MPU9250 연결 준비**
```cpp
다음 단계에서 사용할 연결:
• VCC → 3.3V (중요: 5V 아님!)
• GND → GND
• SDA → D4 (GPIO 4)
• SCL → D5 (GPIO 5)
• AD0 → GND (I2C 주소 0x68 설정)
```

### **4.3 개발 팁**
```
💡 효율적인 개발을 위한 팁:
1. 각 테스트마다 별도 파일로 저장
2. 작동하는 코드는 백업 폴더에 보관
3. 시리얼 모니터 출력을 텍스트 파일로 저장
4. 문제 발생시 마지막 작동 버전으로 복구
5. 각 단계별 사진 촬영 (연결 상태 기록)
```

---

## 🎯 완료 후 다음 목표

```
✅ Phase 1 완료!
📍 현재 위치: Arduino Nano ESP32 기본 동작 확인

🚀 다음 단계:
• MPU9250 센서 연결
• I2C 통신 테스트  
• 센서 데이터 읽기
• 실시간 모니터링 시스템 구축
```

**축하합니다! 이제 Arduino Nano ESP32의 기본 기능을 모두 확인했습니다. 다음 단계인 MPU9250 센서 연결로 진행할 준비가 되었습니다! 🎉**